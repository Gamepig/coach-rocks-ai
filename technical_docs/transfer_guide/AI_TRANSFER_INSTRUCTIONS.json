{
  "metadata": {
    "title": "CoachRocks AI - å°ˆæ¡ˆè½‰ç§»æŒ‡ä»¤é›†",
    "version": "1.0",
    "created": "2025-11-19",
    "source": "PROJECT_OWNERSHIP_TRANSFER_GUIDE.md",
    "description": "JSON æ ¼å¼çš„ AI å¯åŸ·è¡ŒæŒ‡ä»¤é›†ï¼Œç”¨æ–¼è‡ªå‹•åŒ–å°ˆæ¡ˆæ‰€æœ‰æ¬Šè½‰ç§»"
  },
  "global_config": {
    "old_owner": "gamepig1976@gmail.com",
    "new_owner": "katherine84522@gmail.com",
    "old_backend_url": "https://coach-backend.gamepig1976.workers.dev",
    "new_backend_url": "https://coach-backend.katherine84522.workers.dev",
    "old_account_id": "9288c023577aa2f6ce20582b6c4bdda0",
    "new_account_id": "[WAITING_FOR_INPUT]",
    "old_database_id": "d15ec66a-762c-40a2-bc8e-d64a1c8eb440",
    "new_database_id": "[WAITING_FOR_INPUT]"
  },
  "phases": {
    "phase_1": {
      "name": "Cloudflare å¸³æˆ¶æº–å‚™",
      "execution_by": "ä½¿ç”¨è€…ï¼ˆæ‰‹å‹•ï¼‰",
      "steps": [
        {
          "step_id": "P1_S1",
          "name": "ç²å– Cloudflare Account ID",
          "type": "manual",
          "instructions": "1. ç™»å…¥ https://dash.cloudflare.com\n2. è¤‡è£½å³ä¸Šè§’çš„ Account ID\n3. æä¾›çµ¦ AI",
          "output_field": "new_account_id"
        },
        {
          "step_id": "P1_S2",
          "name": "å»ºç«‹ Cloudflare Workers",
          "type": "manual",
          "instructions": "1. å»ºç«‹æ–° Workerï¼šcoach-backend\n2. ä½¿ç”¨ wrangler deploy éƒ¨ç½²\n3. é©—è­‰ URL ç‚ºï¼šhttps://coach-backend.katherine84522.workers.dev"
        },
        {
          "step_id": "P1_S3",
          "name": "å»ºç«‹ Cloudflare Pages",
          "type": "manual",
          "instructions": "1. å»ºç«‹æ–° Pages å°ˆæ¡ˆï¼šcoach-rocks-frontend\n2. ä½¿ç”¨ wrangler pages deploy éƒ¨ç½²å‰ç«¯\n3. é©—è­‰ URL ç‚ºï¼šhttps://coach-rocks-frontend.pages.dev"
        }
      ]
    },
    "phase_2": {
      "name": "è‡ªå‹•åŒ– URL å’Œé…ç½®æ›´æ–°",
      "execution_by": "AI",
      "steps": [
        {
          "step_id": "AUTO_001",
          "operation": "batch_replace_backend_url",
          "priority": "P0",
          "description": "æ‰¹é‡æ›´æ–°æ‰€æœ‰æª”æ¡ˆä¸­çš„å¾Œç«¯ URL",
          "bash_command": "find . -type f \\( -name '*.ts' -o -name '*.tsx' -o -name '*.jsx' -o -name '*.js' -o -name '*.jsonc' -o -name '.dev.vars' -o -name '.env.*' -o -name '*.sh' \\) ! -path '*./.git/*' ! -path '*/node_modules/*' ! -path '*/.wrangler/*' -exec sed -i '' 's|https://coach-backend\\.gamepig1976\\.workers\\.dev|https://coach-backend.katherine84522.workers.dev|g' {} +",
          "verification_command": "grep -r 'coach-backend.gamepig1976' --include='*.ts' --include='*.js' --include='*.jsonc' --include='.dev.vars' --include='.env.*' . 2>/dev/null | grep -v technical_docs | wc -l",
          "expected_result": "0"
        },
        {
          "step_id": "AUTO_002",
          "operation": "update_git_config",
          "priority": "P0",
          "description": "æ›´æ–° Git ç”¨æˆ¶éƒµç®±",
          "bash_command": "git config user.email 'katherine84522@gmail.com'",
          "verification_command": "git config user.email",
          "expected_result": "katherine84522@gmail.com"
        },
        {
          "step_id": "AUTO_003",
          "operation": "update_wrangler_account_id",
          "priority": "P0",
          "description": "æ›´æ–° backend/wrangler.jsonc ä¸­çš„ account_id",
          "requires_input": "new_account_id",
          "bash_command": "sed -i '' 's/\"account_id\": \"9288c023577aa2f6ce20582b6c4bdda0\"/\"account_id\": \"${new_account_id}\"/g' backend/wrangler.jsonc",
          "verification_command": "grep '\"account_id\"' backend/wrangler.jsonc",
          "note": "éœ€è¦åœ¨ P1_S1 å¾ŒåŸ·è¡Œ"
        },
        {
          "step_id": "AUTO_004",
          "operation": "update_script_emails",
          "priority": "P1",
          "description": "æ›´æ–°è…³æœ¬ä¸­çš„éƒµç®±",
          "bash_command": "find scripts -name '*.sh' -exec sed -i '' 's/gamepig1976@gmail\\.com/katherine84522@gmail.com/g' {} +",
          "verification_command": "grep -r 'gamepig1976@gmail.com' scripts/ 2>/dev/null | wc -l",
          "expected_result": "0"
        },
        {
          "step_id": "AUTO_005",
          "operation": "verify_no_remnants",
          "priority": "P0",
          "description": "é©—è­‰æ²’æœ‰éºæ¼çš„èˆŠå€¼",
          "bash_commands": [
            "echo '=== æª¢æŸ¥ gamepig1976 ==='; grep -r 'gamepig1976' --include='*.ts' --include='*.js' --include='*.jsonc' --include='.dev.vars' --include='.env.*' . --exclude-dir='.git' --exclude-dir='node_modules' --exclude-dir='technical_docs' 2>/dev/null || echo 'âœ… æœªæ‰¾åˆ°'",
            "echo ''; echo '=== æª¢æŸ¥èˆŠ Account ID ==='; grep -r '9288c023577aa2f6ce20582b6c4bdda0' --include='*.jsonc' --exclude-dir='.git' . 2>/dev/null || echo 'âœ… æœªæ‰¾åˆ°'",
            "echo ''; echo '=== æª¢æŸ¥èˆŠ Database ID ==='; grep -r 'd15ec66a-762c-40a2-bc8e-d64a1c8eb440' --include='*.jsonc' --exclude-dir='.git' . 2>/dev/null || echo 'âœ… æœªæ‰¾åˆ°'"
          ],
          "expected_result": "æ‰€æœ‰æª¢æŸ¥éƒ½è¿”å› âœ…"
        }
      ]
    },
    "phase_3": {
      "name": "Google OAuth å’Œ Secrets é…ç½®",
      "execution_by": "æ··åˆï¼ˆä½¿ç”¨è€… æä¾›ä¿¡æ¯ï¼ŒAI åŸ·è¡Œï¼‰",
      "steps": [
        {
          "step_id": "P3_S1",
          "operation": "create_google_oauth_credentials",
          "priority": "P0",
          "type": "manual",
          "description": "åœ¨ Google Console å»ºç«‹æ–°çš„ OAuth æ†‘è­‰",
          "instructions": "1. å‰å¾€ https://console.cloud.google.com/\n2. å»ºç«‹æ–° OAuth 2.0 Client ID\n3. Authorized redirect URIs åŠ å…¥ï¼šhttps://coach-backend.katherine84522.workers.dev/api/auth/google/callback\n4. ç²å– Client ID å’Œ Client Secret",
          "output_fields": [
            "google_client_id",
            "google_client_secret"
          ]
        },
        {
          "step_id": "AUTO_006",
          "operation": "update_google_oauth_secrets",
          "priority": "P0",
          "requires_input": [
            "google_client_id",
            "google_client_secret"
          ],
          "description": "æ›´æ–° Wrangler ä¸­çš„ Google OAuth Secrets",
          "bash_commands": [
            "cd backend",
            "echo '${google_client_id}' | wrangler secret put GOOGLE_CLIENT_ID",
            "echo '${google_client_secret}' | wrangler secret put GOOGLE_CLIENT_SECRET",
            "echo 'https://coach-backend.katherine84522.workers.dev/api/auth/google/callback' | wrangler secret put GOOGLE_REDIRECT_URI"
          ],
          "verification_command": "cd backend && wrangler secret list | grep -E 'GOOGLE|REDIRECT'",
          "note": "éœ€è¦åœ¨ P3_S1 å¾ŒåŸ·è¡Œ"
        },
        {
          "step_id": "AUTO_007",
          "operation": "copy_other_secrets",
          "priority": "P1",
          "description": "è¤‡è£½å…¶ä»–å¿…è¦çš„ Secretsï¼ˆå¾èˆŠå¸³æˆ¶ï¼‰",
          "instructions": "AI éœ€è¦å¾ backend/.dev.vars è®€å–ä»¥ä¸‹å€¼ä¸¦è¨­ç½®åˆ°æ–°å¸³æˆ¶ï¼š\n- OPENAI_API_KEY\n- PERPLEXITY_API_KEY\n- SERPER_API_KEY\n- JWT_SECRET\n- RESEND_API_KEY",
          "bash_commands": [
            "cd backend",
            "# è®€å–èˆŠ .dev.vars ä¸­çš„ secrets",
            "grep -E '^(OPENAI|PERPLEXITY|SERPER|JWT|RESEND)' .dev.vars | while IFS='=' read key value; do",
            "  wrangler secret put $key <<< $value",
            "done",
            "# è¨­ç½®æ‡‰ç”¨ URL",
            "echo 'https://coach-backend.katherine84522.workers.dev' | wrangler secret put BACKEND_URL",
            "echo 'https://coach-rocks-frontend.pages.dev' | wrangler secret put FRONTEND_URL",
            "echo 'noreply@coachrocks.com' | wrangler secret put FROM_EMAIL",
            "echo 'CoachRocks AI' | wrangler secret put APP_NAME"
          ],
          "verification_command": "cd backend && wrangler secret list"
        },
        {
          "step_id": "AUTO_008",
          "operation": "configure_resend_email_service",
          "priority": "P1",
          "description": "é…ç½® RESEND éƒµä»¶æœå‹™",
          "automation_type": "hybrid",
          "resend_config": {
            "api_key": "[ä½¿ç”¨èˆŠå¸³æˆ¶çš„ backend/.dev.vars ä¸­çš„ RESEND_API_KEY]",
            "development": {
              "from_email": "onboarding@resend.dev",
              "requires_verification": false,
              "timing": "ç«‹å³"
            },
            "production": {
              "from_email": "noreply@coachrocks.com",
              "requires_verification": true,
              "timing": "Phase 6 å¾ŒåŸ·è¡Œ"
            }
          },
          "bash_commands": [
            "cd backend",
            "# è¨­ç½® RESEND_API_KEY",
            "# ç²˜è²¼èˆŠå¸³æˆ¶çš„ RESEND_API_KEYï¼ˆè¦‹ backend/.dev.varsï¼‰",
            "# é©—è­‰è¨­ç½®",
            "wrangler secret list | grep RESEND",
            "# æ¸¬è©¦éƒµä»¶æœå‹™",
            "echo 'ğŸ“§ æµ‹è¯• RESEND éƒµä»¶æœå‹™ï¼ˆå¯é€‰ï¼‰' && node test-resend-email.js test@example.com 2>/dev/null || echo 'âš ï¸ éƒµä»¶æ¸¬è©¦å¯é¸ï¼Œé–‹ç™¼ç’°å¢ƒå¯è·³é'"
          ],
          "verification_command": "cd backend && wrangler secret list | grep -E 'RESEND|FROM_EMAIL'",
          "manual_steps": [
            {
              "step": "1ï¸âƒ£ RESEND é–‹ç™¼ç’°å¢ƒï¼ˆç«‹å³åŸ·è¡Œï¼‰",
              "action": "è‡ªå‹•è¨­ç½®",
              "details": "ä½¿ç”¨æ¸¬è©¦åŸŸå onboarding@resend.devï¼Œä¸éœ€é©—è­‰ï¼Œå¯ç›´æ¥ç™¼é€éƒµä»¶"
            },
            {
              "step": "2ï¸âƒ£ RESEND ç”Ÿç”¢ç’°å¢ƒé©—è­‰ï¼ˆPhase 6 åŸ·è¡Œï¼‰",
              "action": "æ‰‹å‹•åœ¨ RESEND Dashboard",
              "details": "1. ç™»å…¥ https://resend.com\n2. Domains â†’ Add Domain â†’ è¼¸å…¥ coachrocks.com\n3. è¤‡è£½ DNS è¨˜éŒ„åˆ° Cloudflare Dashboard â†’ coachrocks.com â†’ DNS\n4. ç­‰å¾…é©—è­‰å®Œæˆï¼ˆ5-30 åˆ†é˜ï¼‰\n5. é©—è­‰å¾Œä½¿ç”¨ noreply@coachrocks.com ç™¼é€éƒµä»¶"
            }
          ],
          "note": "RESEND_API_KEY å·²åœ¨ AUTO_007 ä¸­ä½œç‚º Secrets è¤‡è£½ï¼Œæ­¤æ­¥é©Ÿæä¾›é¡å¤–çš„æ¸¬è©¦å’Œé©—è­‰"
        }
      ]
    },
    "phase_4": {
      "name": "è³‡æ–™åº«é·ç§»",
      "execution_by": "æ··åˆ",
      "steps": [
        {
          "step_id": "P4_S1",
          "operation": "migrate_d1_database",
          "priority": "P0",
          "type": "hybrid",
          "description": "é·ç§» D1 è³‡æ–™åº«è‡³ ä½¿ç”¨è€… å¸³æˆ¶",
          "options": [
            {
              "option": "Aï¼ˆæ¨è–¦ï¼‰",
              "method": "ä½¿ç”¨ Wrangler export/import",
              "steps": [
                "1. AI åŸ·è¡Œï¼šcd backend && wrangler d1 export coachdb > backup.sql",
                "2. è½‰ç§» backup.sql è‡³ ä½¿ç”¨è€…",
                "3. ä½¿ç”¨è€… å»ºç«‹æ–°è³‡æ–™åº«ï¼šcoachdb",
                "4. AI åŸ·è¡Œï¼šwrangler d1 import coachdb backup.sql",
                "5. è¨˜éŒ„æ–°çš„ database_idï¼ˆå¾ ä½¿ç”¨è€… å¸³æˆ¶ï¼‰",
                "6. AI æ›´æ–° wrangler.jsonc ä¸­çš„ database_id"
              ]
            },
            {
              "option": "B",
              "method": "æ–°å»ºç©ºè³‡æ–™åº«ï¼ˆå¿«é€Ÿä½†æœƒéºå¤±æ•¸æ“šï¼‰",
              "steps": [
                "1. ä½¿ç”¨è€… åœ¨ Cloudflare å»ºç«‹æ–° D1ï¼šcoachdb",
                "2. è¨˜éŒ„æ–°çš„ database_id",
                "3. AI æ›´æ–° wrangler.jsonc",
                "4. åˆå§‹åŒ–è³‡æ–™åº«çµæ§‹"
              ]
            }
          ]
        },
        {
          "step_id": "AUTO_008",
          "operation": "update_database_id",
          "priority": "P0",
          "requires_input": "new_database_id",
          "description": "æ›´æ–° wrangler.jsonc ä¸­çš„ database_id",
          "bash_command": "sed -i '' 's/\"database_id\": \"d15ec66a-762c-40a2-bc8e-d64a1c8eb440\"/\"database_id\": \"${new_database_id}\"/g' backend/wrangler.jsonc",
          "verification_command": "grep '\"database_id\"' backend/wrangler.jsonc",
          "note": "éœ€è¦åœ¨ P4_S1 å¾ŒåŸ·è¡Œ"
        }
      ]
    },
    "phase_5": {
      "name": "é©—è­‰å’Œéƒ¨ç½²",
      "execution_by": "AI",
      "steps": [
        {
          "step_id": "VERIFY_001",
          "operation": "verify_code_clean",
          "priority": "P0",
          "description": "é©—è­‰ä»£ç¢¼ä¸­ç„¡ç¡¬ç·¨ç¢¼èˆŠå€¼",
          "bash_commands": [
            "echo '=== æª¢æŸ¥èˆŠåŸŸå ==='; grep -r 'gamepig1976' --include='*.ts' --include='*.js' --include='*.jsonc' --include='.dev.vars' . --exclude-dir='.git' --exclude-dir='node_modules' --exclude-dir='technical_docs' 2>/dev/null | wc -l",
            "echo '=== æª¢æŸ¥èˆŠ Account ID ==='; grep -r '9288c023577aa2f6ce20582b6c4bdda0' --include='*.ts' --include='*.jsonc' . --exclude-dir='.git' 2>/dev/null | wc -l",
            "echo '=== æª¢æŸ¥èˆŠ Database ID ==='; grep -r 'd15ec66a-762c-40a2-bc8e-d64a1c8eb440' --include='*.jsonc' . --exclude-dir='.git' 2>/dev/null | wc -l"
          ],
          "expected_result": "æ‰€æœ‰è¿”å› 0"
        },
        {
          "step_id": "VERIFY_002",
          "operation": "verify_configs",
          "priority": "P0",
          "description": "é©—è­‰é…ç½®æª”æ¡ˆæ­£ç¢º",
          "checks": [
            {
              "file": "backend/wrangler.jsonc",
              "contains": "new_account_id",
              "should_not_contain": "9288c023577aa2f6ce20582b6c4bdda0"
            },
            {
              "file": "frontend/.env.production",
              "contains": "https://coach-backend.katherine84522.workers.dev",
              "should_not_contain": "gamepig1976"
            },
            {
              "file": "backend/.dev.vars",
              "contains": "https://coach-backend.katherine84522.workers.dev",
              "should_not_contain": "gamepig1976"
            }
          ],
          "bash_commands": [
            "echo '=== wrangler.jsonc ==='; grep -E 'account_id|database_id|\"name\"' backend/wrangler.jsonc",
            "echo ''; echo '=== .env.production ==='; cat frontend/.env.production",
            "echo ''; echo '=== .dev.vars (é—œéµé …) ==='; grep -E '^(GOOGLE_REDIRECT|BACKEND_URL|FRONTEND_URL)' backend/.dev.vars"
          ]
        },
        {
          "step_id": "VERIFY_003",
          "operation": "test_connectivity",
          "priority": "P0",
          "description": "æ¸¬è©¦å¾Œç«¯é€£æ¥æ€§",
          "tests": [
            {
              "name": "Health Check",
              "command": "curl -s https://coach-backend.katherine84522.workers.dev/api/health | jq .",
              "expected": "200 OK with status field"
            },
            {
              "name": "Google OAuth Init",
              "command": "curl -s -X GET 'https://coach-backend.katherine84522.workers.dev/api/auth/google/init' -H 'Content-Type: application/json' | jq .",
              "expected": "200 OK with authorization_url"
            }
          ]
        },
        {
          "step_id": "DEPLOY_001",
          "operation": "deploy_backend",
          "priority": "P0",
          "description": "éƒ¨ç½²å¾Œç«¯è‡³ Cloudflare Workers",
          "bash_commands": [
            "cd backend",
            "npm run deploy"
          ],
          "expected_result": "Successfully deployed to https://coach-backend.katherine84522.workers.dev"
        },
        {
          "step_id": "DEPLOY_002",
          "operation": "deploy_frontend",
          "priority": "P0",
          "description": "éƒ¨ç½²å‰ç«¯è‡³ Cloudflare Pages",
          "bash_commands": [
            "cd frontend",
            "npm run build",
            "wrangler pages deploy dist --project-name=coach-rocks-frontend"
          ],
          "expected_result": "Successfully deployed to https://coach-rocks-frontend.pages.dev"
        }
      ]
    }
  },
  "rollback_procedures": {
    "scenario_1": {
      "name": "å¾Œç«¯éƒ¨ç½²å¤±æ•—",
      "steps": [
        "git checkout backend/wrangler.jsonc",
        "cd backend && wrangler deploy"
      ]
    },
    "scenario_2": {
      "name": "ç™¼ç¾éºæ¼çš„èˆŠå€¼",
      "command": "find . -type f \\( -name '*.ts' -o -name '*.js' \\) ! -path '*./.git/*' -exec sed -i '' 's/gamepig1976/katherine84522/g' {} + && cd backend && npm run deploy"
    },
    "scenario_3": {
      "name": "è³‡æ–™åº«é·ç§»å¤±æ•—",
      "steps": [
        "wrangler d1 export coachdb backup.sql",
        "# å¾å‚™ä»½æ¢å¾©æˆ–é‡æ–°é·ç§»"
      ]
    }
  },
  "quick_reference": {
    "files_to_modify": [
      "backend/wrangler.jsonc",
      "frontend/.env.production",
      "backend/.dev.vars",
      "scripts/*.sh"
    ],
    "critical_replacements": [
      {
        "old": "gamepig1976",
        "new": "katherine84522",
        "files": "å¤šå€‹"
      },
      {
        "old": "https://coach-backend.gamepig1976.workers.dev",
        "new": "https://coach-backend.katherine84522.workers.dev",
        "files": "23+ æª”æ¡ˆ"
      },
      {
        "old": "9288c023577aa2f6ce20582b6c4bdda0",
        "new": "[æ–° Account ID]",
        "files": "backend/wrangler.jsonc"
      },
      {
        "old": "d15ec66a-762c-40a2-bc8e-d64a1c8eb440",
        "new": "[æ–° Database ID]",
        "files": "backend/wrangler.jsonc"
      }
    ],
    "ai_executable_operations": [
      "AUTO_001 - æ‰¹é‡æ›´æ–° URL",
      "AUTO_002 - æ›´æ–° Git é…ç½®",
      "AUTO_003 - æ›´æ–° Account ID",
      "AUTO_004 - æ›´æ–°è…³æœ¬éƒµç®±",
      "AUTO_005 - é©—è­‰ç„¡éºæ¼",
      "AUTO_006 - æ›´æ–° OAuth Secrets",
      "AUTO_007 - è¤‡è£½å…¶ä»– Secrets",
      "AUTO_008 - æ›´æ–° Database ID",
      "VERIFY_001 - ä»£ç¢¼é©—è­‰",
      "VERIFY_002 - é…ç½®é©—è­‰",
      "VERIFY_003 - é€£æ¥æ€§æ¸¬è©¦",
      "DEPLOY_001 - éƒ¨ç½²å¾Œç«¯",
      "DEPLOY_002 - éƒ¨ç½²å‰ç«¯"
    ],
    "manual_operations": [
      "P1_S1 - ç²å– Cloudflare Account ID",
      "P1_S2 - å»ºç«‹ Workers",
      "P1_S3 - å»ºç«‹ Pages",
      "P3_S1 - å»ºç«‹ Google OAuth æ†‘è­‰",
      "P4_S1 - è³‡æ–™åº«é·ç§»ï¼ˆé¸é … A æˆ– Bï¼‰"
    ]
  }
}
